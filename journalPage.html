<!DOCTYPE html>
<html>
    <html>
        <head>
            <title>Journal Details</title>
            <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
            <style>
                .truncated {
                    max-width: 100%;
                    overflow: hidden; 
                    text-overflow: ellipsis; 
                    white-space: nowrap; 
                    cursor: pointer; 
                }
                .expanded {
                    white-space: normal;
                    cursor: pointer; 
                }
            </style>
        </head>
        <body class="bg-gray-100">
            <div class="container mx-auto p-4">
                <h1 id="journal-title" class="text-2xl font-bold text-center text-gray-700">Journal</h1>
                <button id="deleteJournalBtn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mt-2">Delete Journal</button>
                <button id="deleteSelectedEntriesBtn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mt-2">Delete Selected Entries</button>
                <ul id="journal-entries" class="divide-y divide-gray-300 mt-4">
                </ul>
                <form id="new-entry-form" class="flex flex-col space-y-2 mt-4">
                    <h3 class="text-lg font-bold text-gray-700">Add New Entry</h3>
                    <label for="entry-text" class="font-bold">Entry Text:</label>
                    <textarea id="entry-text" name="entry-text" required class="p-2 border rounded"></textarea><br>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add Entry</button>
                </form>
                <button id="goBack" class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Go Back</button>
            </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const urlParams = new URLSearchParams(window.location.search);
                const journalID = urlParams.get('journalID');
                console.log(journalID);
                if (journalID) {
                    fetchEntries(journalID);
                }

                function fetchEntries(journalID) {
                    fetch(`/getEntries`,{
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ JournalID: parseInt(journalID)})
                    })
                    .then(response => response.json())
                    .then(data => {
                        const entriesList = document.getElementById('journal-entries');
                        data.forEach(entry => {
                            const listItem = document.createElement('li');
                            listItem.classList.add("flex", "justify-between", "items-center", "p-2", "hover:bg-gray-200");
                            listItem.innerHTML = `<input type="radio" name="entryRadio" class="form-radio" data-entry-id="${entry.EntryID}"><span class="truncated" onclick="toggleText(this)">${entry.EntryText}</span>`;
                            entriesList.appendChild(listItem);
                        });
                    })
                    .catch(error => console.error('Error fetching journal:', error));
                }

                document.getElementById('new-entry-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    const entryText = document.getElementById('entry-text').value;
                    addEntry(journalID, entryText);
                });

                document.getElementById('goBack').addEventListener('click', function() {
                    window.location.href = 'Journal.html';
                });
            });

            function addEntry(journalID, entryText) {
                fetch('/journalEntry', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ JournalID: parseInt(journalID), EntryText: entryText })
                })
                .then(response => response.json())
                .then(data => {
                    const entriesList = document.getElementById('journal-entries');
                    const listItem = document.createElement('li');
                    listItem.classList.add("flex", "justify-between", "items-center", "p-2", "hover:bg-gray-200");
                     listItem.innerHTML = `<input type="radio" name="entryRadio" class="form-radio" data-entry-id="${data.EntryID}"><span class="truncated" onclick="toggleText(this)">${entryText}</span>`;;
                    entriesList.appendChild(listItem);
                    document.getElementById('entry-text').value = '';
                })
                .catch(error => console.error('Error adding entry:', error));
            }
            document.getElementById('journal-entries').addEventListener('click', function(event) {
                    if (event.target.tagName === 'SPAN') {
                        toggleText(event.target);
                    }
                });
            function toggleText(element) {
               
                if (element.classList.contains('truncated')) {
                    element.classList.remove('truncated');
                    element.classList.add('expanded');
                } else {
                    element.classList.add('truncated');
                    element.classList.remove('expanded');
                }
            }

            document.getElementById('deleteJournalBtn').addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);           
    const journalID = urlParams.get('journalID');  
    fetch('/deleteJournal', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ journalID: parseInt(journalID) })
    })
    .then(response => response.json())
    .then(data => {
        
        window.location.href = 'Journal.html'; 
    })
    .catch(error => console.error('Error:', error));
});

document.getElementById('deleteSelectedEntryBtn').addEventListener('click', function() {
    deleteEntries();  
});

function deleteEntries() {
    const selectedEntry = document.querySelector('input[type="radio"]:checked');
    if (selectedEntry) {
        const entryID = selectedEntry.getAttribute('data-entry-id');
        fetch(`/deleteEntry`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ EntryID: parseInt(entryID) })
        })
        .then(response => response.json())
        .then(data => {
            alert('Entry deleted successfully!');
            selectedEntry.parentElement.remove();  
        })
        .catch(error => console.error('Error deleting entry:', error));
    } else {
        alert('No entry selected for deletion.');
    }
}

        </script>
        
        
    </body>
</html>
